{% extends "base.html" %}
{% block head %}
  <title>Waar is mijn stemlokaal - Overzicht stembureaus</title>
  <meta property="og:title" content="Waar is mijn stemlokaal - Overzicht stembureaus" />
  {{ super() }}
{% endblock %}

{% block content %}
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
<link href="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.css" rel="stylesheet">

<script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table-locale-all.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/export/bootstrap-table-export.min.js"></script>

  <div>
    {% if current_user.gemeenten|length > 1 %}
    > <a href="{{ url_for('gemeente_selectie') }}">{{ gemeente.gemeente_naam }} [wijzig gemeente]</a>
    {% endif %}
    > <a href="{{ url_for('gemeente_stemlokalen_dashboard') }}">Dashboard</a> > Stembureaus
    <a class="btn btn-default pull-right" role="button" href="{{ url_for('gemeente_instructies') }}">Help</a>
  </div>

  <h1 class="title-pad">Stembureaus</h1>

  <br>

  Overzicht van de stembureaus van de gemeente {{ gemeente.gemeente_naam }} voor {{ verkiezing_string | safe }}.

  <br>
  <br>

  {% if upload_deadline_passed %}
    <span class="text-red">De deadline voor het toevoegen van stembureaus is verlopen.</span>
    <br>
  {% else %}
    {% if not draft_records %}
    <p class="text-red">[Dit overzicht is nog leeg, maar op het <a href="{{ url_for('gemeente_stemlokalen_dashboard') }}">dashboard</a> kunt u een stembureau-spreadsheet downloaden dat al deels vooringevuld is]</p>
    {% endif %}
    <a class="btn btn-info" role="button" href="{{ url_for('gemeente_stemlokalen_edit') }}">Voeg nieuw stembureau toe</a>

    <br>
    <br>

    <form method="POST" action="">
      {{ publish_form.csrf_token }}
    {% if disable_publish_form %}
      {{ publish_form.submit(disabled=True) }}
      {% if draft_records %}
        [de stembureaus zijn gepubliceerd]
      {% endif %}
    {% else %}
      {{ publish_form.submit }} [<span class="text-red">let op: er zijn wijzigingen in dit overzicht die u nog niet heeft gepubliceerd</span>]
    {% endif %}
    </form>
  {% endif %}

  <br>
    <div style="overflow-x: auto;">
      <!-- TODO: make table paginate server side -->
    <table
        data-search="true"
        data-show-fullscreen="true"
        data-show-export="true"
        data-toggle="table"
        data-pagination="true"
        data-page-list="[10, 25, 50, 100, all]"
        data-show-toggle="true"
        data-click-to-select="true"
        data-detail-formatter="detailFormatter"
        data-show-pagination-switch="true"
        data-id-field="BAG Nummeraanduiding ID"
        data-response-handler="responseHandler"
      >
      <thead>
        <tr>
            <th data-field="operate" clickToSelect="false" events="window.operateEvents" formatter="operateFormatter"></th>
            </th>
          {% for field in field_order %}
            <th data-field="{{ field }}" data-sortable="true">
              {{ field }}
            </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
      {% for record in draft_records %}
      <tr>
      {% if not upload_deadline_passed %}
      <td>
        <a href="{{ url_for('gemeente_stemlokalen_edit', stemlokaal_id=record['UUID']) }}">[bewerk]</a>
      </td>
      {% endif %}        
          {% for field in field_order %}
            <td>
              {% if record[field[:62]] != None %}
              {{ record[field[:62]] }}
              {% endif %}
            </td>
          {% endfor %}
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <br>

  <br>
  <br>

  In totaal {{ total_records }} stembureaus.

{% endblock %}
{% block scripts %}
  {{ super() }}
  <script>
    $(function () {
      $('[data-toggle="tooltip"]').tooltip();
      $('[data-toggle="popover"]').popover();
    })
  </script>
{% endblock %}
