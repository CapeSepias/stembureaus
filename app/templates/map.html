<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
  integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
  crossorigin=""></script>
<script>

    var StembureausApp = window.StembureausApp || {stembureaus: [],links_external: false};

    StembureausApp.stembureaus = {{ records |tojson |safe }};
    StembureausApp.stembureaus_markers = [];

    console.log(StembureausApp.links_external ? 'external links for markers' : 'internal links for markers');

    StembureausApp.getPopup = function(s) {
      var opinfo = StembureausApp.stembureaus[i]['Openingstijden'].split(' tot ');
      var target = StembureausApp.links_external ? ' target="_blank"' : '';
      output = "<p><a href=\"/s/" + StembureausApp.stembureaus[i]['Gemeente'] + '/' + StembureausApp.stembureaus[i]['UUID'] + "\"" + target + ">" + StembureausApp.stembureaus[i]['Naam stembureau'] + "</a><br />";
      if (StembureausApp.stembureaus[i]['Straatnaam']) {
        output += StembureausApp.stembureaus[i]['Straatnaam'];
      }
      if (StembureausApp.stembureaus[i]['Huisnummer']) {
        output += ' ' + StembureausApp.stembureaus[i]['Huisnummer'];
      }
      if (StembureausApp.stembureaus[i]['Huisnummertoevoeging']) {
        output += '-' + StembureausApp.stembureaus[i]['Huisnummertoevoeging'];
      }
      if (StembureausApp.stembureaus[i]['Plaats']) {
        output += "<br />" + StembureausApp.stembureaus[i]['Plaats'] + "<br />";
      } else {
        output += "<i>Gemeente " + StembureausApp.stembureaus[i]['Gemeente'] + "</i><br />";
      }
      output += '<strong>Open:</strong> ' + opinfo[0].split('T')[1].slice(0, 5) + ' &dash; ' + opinfo[1].split('T')[1].slice(0, 5) + '<br />';
      if (StembureausApp.stembureaus[i]["Mindervaliden toegankelijk"] == 'Y') {
        output += '<i class="fa fa-wheelchair" aria-hidden="true"></i>';
      }
      output += '</p>';
      return output;
    };

    for(var i=0; i < StembureausApp.stembureaus.length; i++) {
      StembureausApp.stembureaus_markers.push(
        L.marker(
          [StembureausApp.stembureaus[i].Latitude, StembureausApp.stembureaus[i].Longitude]
        ).bindPopup(StembureausApp.getPopup(StembureausApp.stembureaus[i]))
      );
    }


    StembureausApp.layers = {
      'Stembureaus': L.layerGroup(StembureausApp.stembureaus_markers)
    };
    StembureausApp.map = L.map('map', {'layers': StembureausApp.layers['Stembureaus']}).setView([52.2, 5.592], 6);
    StembureausApp.group = L.featureGroup(StembureausApp.stembureaus_markers);
    StembureausApp.map.fitBounds(StembureausApp.group.getBounds());

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright" target="_blank">OpenStreetMap</a> contributors | <a href="https://waarismijnstemlokaal.nl/" target="_blank">Waar is mijn stemlokaal</a>'
    }).addTo(StembureausApp.map);

</script>
